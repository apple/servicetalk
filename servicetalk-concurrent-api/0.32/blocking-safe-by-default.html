<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Blocking safe by default :: ServiceTalk Docs</title>
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<meta name="description" content="ServiceTalk is a JVM network application framework with APIs tailored to specific protocols (e.g. HTTP/1.x, HTTP/2.x, etc…​) and supports multiple programming paradigms.">
<meta name="keywords" content="servicetalk, java, reactive, reactive-streams, microservices, framework, http, http2, rpc, grpc, netty">
<link rel="stylesheet" href="../../_/css/site-extra.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151504011-1"></script>
<script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-151504011-1')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://github.com/apple/servicetalk">ServiceTalk</a>
        <span class="separator">//</span>
        <a href="../..">Docs</a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
    <div class="navigation-container"
      data-component="servicetalk-concurrent-api" data-version="0.32">
    <aside class="navigation">
        <div class="panels">
            <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Concurrent API</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk/0.32/programming-paradigms.html">Programming Paradigms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk/0.32/blocking-safe-by-default.html">Blocking safe by default</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk/0.32/evolve-to-async.html">Evolving to asynchronous</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk/0.32/async-context.html">Async context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk/0.32/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Examples</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html">HTTP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html#HelloWorld">Hello World</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html#Serialization">Serialization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html#JAXRS">JAX-RS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html#MetaData">MetaData</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/index.html#HTTP2">HTTP/2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/http/service-composition.html">Service Composition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../servicetalk-examples/0.32/grpc/index.html">gRPC</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/grpc/index.html#HelloWorld">Hello World</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-examples/0.32/grpc/index.html#route-guide">Route Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Concurrent API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="asynchronous-primitives.html">Asynchronous primitives</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="blocking-safe-by-default.html">Blocking safe by default</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="blocking-implementation.html">Implementation details</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="async-context.html">Async Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../servicetalk-http-api/0.32/index.html">HTTP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk-http-api/0.32/programming-paradigms.html">Programming paradigms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk-http-api/0.32/blocking-safe-by-default.html">Blocking safe by default</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../servicetalk-http-api/0.32/evolve-to-async.html">Evolving to asynchronous</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../servicetalk-http-router-jersey/0.32/index.html">JAX-RS Router (Jersey)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-http-router-jersey/0.32/evolve-to-async.html">Evolving to asynchronous</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-http-security-jersey/0.32/index.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../servicetalk-data-jackson-jersey/0.32/index.html">JSON (Jackson)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk-grpc-api/0.32/index.html">gRPC</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk-loadbalancer/0.32/index.html">Load Balancing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk-client-api/0.32/service-discovery.html">Service Discovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk/0.32/javadoc/index.html">Javadoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../servicetalk/0.32/contributing.html">Contributing</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
            <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Concurrent API</span>
    <span class="version">0.32</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Client API</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-client-api/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-client-api/0.25/index.html">0.25</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Concurrent API</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../0.33/index.html">0.33</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Examples</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-examples/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-examples/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">gRPC</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-grpc-api/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-grpc-api/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">HTTP</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-http-api/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-api/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JAX-RS Router (Jersey)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-http-router-jersey/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-router-jersey/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JSON (Jackson)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-data-jackson-jersey/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-data-jackson-jersey/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Load balancing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-loadbalancer/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-loadbalancer/0.20/index.html">0.20</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk-http-security-jersey/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk-http-security-jersey/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ServiceTalk</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../servicetalk/SNAPSHOT/index.html">SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.33/index.html">0.33</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.32/index.html">0.32</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.31/index.html">0.31</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.30/index.html">0.30</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.29/index.html">0.29</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.28/index.html">0.28</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.27/index.html">0.27</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.26/index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.24/index.html">0.24</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.23/index.html">0.23</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.22/index.html">0.22</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.21/index.html">0.21</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.20/index.html">0.20</a>
        </li>
        <li class="version">
          <a href="../../servicetalk/0.19/index.html">0.19</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
        </div>
    </aside>
</div>
    <main class="main">
        <div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../servicetalk/SNAPSHOT/index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
        <ul>
                <li class="crumb">Concurrent API</li>
                <li class="crumb"><a href="blocking-safe-by-default.html">Blocking safe by default</a></li>
        </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">0.32</button>
  <div class="versions-menu">
    <a class="version" href="../SNAPSHOT/blocking-safe-by-default.html">SNAPSHOT</a>
    <a class="version" href="../0.33/blocking-safe-by-default.html">0.33</a>
    <a class="version is-current" href="blocking-safe-by-default.html">0.32</a>
    <a class="version" href="../0.31/blocking-safe-by-default.html">0.31</a>
    <a class="version" href="../0.30/blocking-safe-by-default.html">0.30</a>
    <a class="version" href="../0.29/blocking-safe-by-default.html">0.29</a>
    <a class="version" href="../0.28/blocking-safe-by-default.html">0.28</a>
    <a class="version" href="../0.27/blocking-safe-by-default.html">0.27</a>
    <a class="version" href="../0.26/blocking-safe-by-default.html">0.26</a>
    <a class="version" href="../0.25/blocking-safe-by-default.html">0.25</a>
    <a class="version" href="../0.24/blocking-safe-by-default.html">0.24</a>
    <a class="version" href="../0.23/blocking-safe-by-default.html">0.23</a>
    <a class="version" href="../0.22/blocking-safe-by-default.html">0.22</a>
    <a class="version" href="../0.21/blocking-safe-by-default.html">0.21</a>
    <a class="version" href="../0.20/blocking-safe-by-default.html">0.20</a>
    <a class="version" href="../0.19/blocking-safe-by-default.html">0.19</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/apple/servicetalk/blob/0.32.0/servicetalk-concurrent-api/docs/modules/ROOT/pages/blocking-safe-by-default.adoc">Edit this Page</a></div>
</div>
        <article class="doc">
<h1>Blocking safe by default</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document elaborates how asynchronous sources provide ways to offload. General philosophy of writing blocking code
while using ServiceTalk is explained <a href="../../servicetalk/0.32/blocking-safe-by-default.html" class="page">here</a> and is a recommended read.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-chain"><a class="anchor" href="#execution-chain"></a><a class="link" href="#execution-chain">Execution chain</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any ServiceTalk asynchronous source (<code>Publisher</code>, <code>Single</code> and <code>Completable</code>) offers multiple operators that can be
applied to the source. Any instance of such a source and all the operators applied to it before it is subscribed, is
called an execution chain.</p>
</div>
<div class="sect2">
<h3 id="data-and-control-flow-in-an-execution-chain"><a class="anchor" href="#data-and-control-flow-in-an-execution-chain"></a><a class="link" href="#data-and-control-flow-in-an-execution-chain">Data and control flow in an execution chain</a></h3>
<div class="paragraph">
<p>The image below details the flow of data (<code>Subscriber</code> methods) and control (<code>Publisher</code> and <code>Subscription</code> methods)
messages. Invocations in either direction may be executed on an event loop thread and hence needs to be protected. In
case new asynchronous sources are generated/received inside operators, they follow the same model and hence are removed
for brevity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blocking-scenarios.png" alt="Data and control flow in an execution chain">
</div>
</div>
<div class="paragraph">
<p>As shown in the above picture, there are inherently two directions (data and control) of information flow for an
execution chain and these
<a href="https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.2/README.md#glossary">signals</a> can be triggered
in parallel.</p>
</div>
<div class="paragraph">
<p><strong>By default, in ServiceTalk, signals are not executed on an event loop thread, but instead executed using an
<a href="https://github.com/apple/servicetalk/blob/0.32.0/servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/Executor.java">Executor</a>
provided by the application in the order they are received.</strong></p>
</div>
<div class="sect3">
<h4 id="implications"><a class="anchor" href="#implications"></a><a class="link" href="#implications">Implications</a></h4>
<div class="paragraph">
<p>The implication of the above approach is the following:</p>
</div>
<div class="paragraph">
<p><strong>Users can execute blocking code inside an execution chain, provided they are not waiting for another data or control
message in the same execution chain.</strong></p>
</div>
<div class="paragraph">
<p>Look at <a href="#pitfalls">Pitfalls</a> section for examples elaborating this implication.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executor-affinity"><a class="anchor" href="#executor-affinity"></a><a class="link" href="#executor-affinity">Executor Affinity</a></h3>
<div class="paragraph">
<p>In ServiceTalk different protocols will provide request processing by means of an asynchronous source, eg: <code>Single</code>.
In such cases, this processing will be expressed as a chain of operators on the asynchronous source. Configuring limits
on resources such as a thread pool can be challenging if <strong>each</strong> operator in the chain may run on different threads.
This would mean applying limits to such a thread pool would be sensitive to program&#8217;s execution flow and may change over
time. In order to make thread pool configuration easier, ServiceTalk provides executor affinity for all asynchronous
sources.</p>
</div>
<div class="sect3">
<h4 id="affinity-for-an-asynchronous-source"><a class="anchor" href="#affinity-for-an-asynchronous-source"></a><a class="link" href="#affinity-for-an-asynchronous-source">Affinity for an asynchronous source</a></h4>
<div class="paragraph">
<p>Let us assume that following expresses request processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> client.request() <i class="conum" data-value="1"></i><b>(1)</b>
       .map(resp -&gt; {
            return doSomeBlockingWorkAndConvertToString(resp); <i class="conum" data-value="2"></i><b>(2)</b>
       })
       .filter(stringResp -&gt; {
            doMoreBlockingWorkToFilterString(stringResp); <i class="conum" data-value="3"></i><b>(3)</b>
       });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A hypothetical client which provides a <code>request()</code> method that returns a <code>Single&lt;Response&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Some blocking work done inside <code>map()</code> operator by this function, which provides a String as a response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Some more blocking work inside <code>filter()</code> operator.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example user provided functions inside both <code>map()</code> and <code>filter()</code> will be invoked using the specified
<code>Executor</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="affinity-across-asynchronous-sources"><a class="anchor" href="#affinity-across-asynchronous-sources"></a><a class="link" href="#affinity-across-asynchronous-sources">Affinity across asynchronous sources</a></h4>
<div class="paragraph">
<p><code>Executor</code> affinity across asynchronous sources is not guaranteed <strong>even if they are part of the same processing chain</strong>.</p>
</div>
<div class="paragraph">
<p>Let us assume that following expresses request processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> client.request() <i class="conum" data-value="1"></i><b>(1)</b>
       .map(resp -&gt; {
            return doSomeBlockingWorkAndConvertToString(resp); <i class="conum" data-value="2"></i><b>(2)</b>
       })
       .flatMap(stringResp -&gt; {
            return client2.request(stringResp) <i class="conum" data-value="3"></i><b>(3)</b>
                          .map(resp -&gt; {
                            doSomeBlockingWorkAgain(); <i class="conum" data-value="4"></i><b>(4)</b>
                          });
       })
       .filter(stringResp -&gt; {
            doMoreBlockingWorkToFilterString(stringResp); <i class="conum" data-value="5"></i><b>(5)</b>
       });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A hypothetical client which provides a <code>request()</code> method that returns a <code>Single&lt;Response&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Some blocking work done inside <code>map()</code> operator by this function, which provides a String as a response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call another <code>client2</code> that provides a new <code>Single</code> which is returned from <code>flatmap</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Do some blocking work inside <code>map()</code> operator for the nested <code>Single</code> returned by Step (3).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Some more blocking work inside <code>filter()</code> operator.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example (2), (3) and (5) will run on one <code>Executor</code> whereas (4) will run on a different <code>Executor</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pitfalls"><a class="anchor" href="#pitfalls"></a><a class="link" href="#pitfalls">Pitfalls</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As defined in <a href="#execution-chain">Execution chain</a>, ServiceTalk sequences events in data and control path of processing as if they were
done on the same thread. Since, data and control events may happen in parallel, there is always a chance for user code
to deadlock if they are executed in sequence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    CountDownLatch latch = new CountDownLatch(1); <i class="conum" data-value="1"></i><b>(1)</b>
    Publisher.from(1, 2, 3, 4)
            .afterOnNext(integer -&gt; {
                latch.countDown();  <i class="conum" data-value="2"></i><b>(2)</b>
            })
            .beforeRequest(requestN -&gt; {
                latch.await(); <i class="conum" data-value="3"></i><b>(3)</b>
            });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Hypothetical synchronization point. In real life it may be due to the code waiting for an event to happen externally.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Trigger the external event (hypothetical synchronization point of <code>CountDownLatch</code>) <strong>after</strong> receiving the item.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Wait for the external event to happen (hypothetical synchronization point of <code>CountDownLatch</code>) <strong>before</strong> sending
<code>requestN</code> to the <code>Publisher</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As per ReactiveStreams <a href="https://github.com/reactive-streams/reactive-streams-jvm#1.1">rule 1.1</a>, request for items
<strong>MUST</strong> happen before the items are delivered. In the above code, we are waiting for an item to be emitted before
sending a request to the <code>Publisher</code>. This results in a deadlock as an item can not be emitted by the source without a
request being received and user code making sure that the request is not sent before an item is emitted.</p>
</div>
<div class="paragraph">
<p>In order to avoid such scenarios, it is handy to follow certain best practices while writing blocking code in operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid co-ordination between two operators on the same source.</p>
</li>
<li>
<p>If such co-ordination is required, try limiting such coordination in either data or control path but not
inter-dependent on each other.</p>
</li>
<li>
<p>If co-ordination is required between data and control path, be aware of ReactiveStreams semantics and how the two
paths interact with each other.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If these rules are followed the above example can be modified to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    CountDownLatch latch = new CountDownLatch(1);
    Publisher.from(1, 2, 3, 4)
            .afterOnNext(integer -&gt; {
                latch.countDown();
            })
            .afterRequest(requestN -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
                latch.await();
            });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>afterRequest</code> which happens <strong>after</strong> <code>requestN</code> is delivered to the source.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this modified example, since we now use <code>afterRequest</code>, instead of <code>beforeRequest</code>, we do not block <code>requestN</code> to
go to the source and this code is safe.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation"><a class="anchor" href="#implementation"></a><a class="link" href="#implementation">Implementation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use ServiceTalk&#8217;s blocking support feature, one does not need to know about implementation details and the
above information is sufficient. However, if you are developing some operators in ServiceTalk or are just curious,
<a href="blocking-implementation.html" class="page">blocking-implementation.adoc</a> describes the design.</p>
</div>
</div>
</div>
</article>
    </main>
</div>
<footer class="footer">
  <p></p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
